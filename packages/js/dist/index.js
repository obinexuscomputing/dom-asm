var e;!function(e){e.Keyword="Keyword",e.Identifier="Identifier",e.Operator="Operator",e.Delimiter="Delimiter",e.Literal="Literal",e.TemplateLiteral="TemplateLiteral",e.Comment="Comment",e.EndOfStatement="EndOfStatement"}(e||(e={}));class t{keywords=new Set(["const","let","var","if","else","function","return"]);operators=new Set(["=","+","-","*","/","%","===","!==","<",">","==","!="]);delimiters=new Set(["(",")","{","}","[","]"]);tokenize(t){const r=[];let a=0;const i=(e,t)=>{r.push({type:e,value:t})};for(t=t.trim();a<t.length;){const r=t[a];if(this.delimiters.has(r)){i(e.Delimiter,r),a++;continue}if(/\s/.test(r)){a++;continue}if(";"===r){i(e.Delimiter,r),a++;continue}if(/[a-zA-Z_$]/.test(r)){let r="";for(;a<t.length&&/[a-zA-Z0-9_$]/.test(t[a]);)r+=t[a++];this.keywords.has(r)?i(e.Keyword,r):i(e.Identifier,r);continue}if(/[0-9]/.test(r)){let r="";for(;a<t.length&&/[0-9.]/.test(t[a]);)r+=t[a++];i(e.Literal,r);continue}const n=t.slice(a),s=this.matchMultiCharOperator(n);if(s)i(e.Operator,s),a+=s.length;else{if(!this.operators.has(r))throw new Error(`Unexpected character: ${r}`);i(e.Operator,r),a++}}return i(e.EndOfStatement,"EOF"),r}matchMultiCharOperator(e){return["===","!==","==","!="].find((t=>e.startsWith(t)))||null}}class r{tokens;position;constructor(e){this.tokens=e,this.position=0}currentToken(){return this.position<this.tokens.length?this.tokens[this.position]:null}consumeToken(){if(this.position>=this.tokens.length)throw new Error("Unexpected end of input");return this.tokens[this.position++]}peekToken(){return this.position+1<this.tokens.length?this.tokens[this.position+1]:null}parseProgram(){const e={type:"Program",children:[]};for(;this.position<this.tokens.length-1;){const t=this.parseStatement();t&&e.children.push(t)}return e}parseStatement(){const t=this.currentToken();if(!t)return null;if(t.type===e.Keyword&&"const"===t.value)return this.parseVariableDeclaration();throw new Error(`Unexpected token: ${t.value}`)}parseVariableDeclaration(){this.consumeToken();const t=this.consumeToken();if(!t||t.type!==e.Identifier)throw new Error("Expected identifier after 'const'");const r=this.consumeToken();if(!r||r.type!==e.Operator||"="!==r.value)throw new Error("Expected '=' after identifier");const a=this.consumeToken();if(!a||a.type!==e.Literal)throw new Error("Expected literal value after '='");const i=this.consumeToken();if(!i||i.type!==e.Delimiter||";"!==i.value)throw new Error("Expected ';' after value");return{type:"VariableDeclaration",children:[{type:"Identifier",value:t.value,children:[]},{type:"Literal",value:a.value,children:[]}]}}buildAST(){return this.parseProgram()}}class a{uniqueNodes=new Map;minimize(e){return this.uniqueNodes.clear(),this.traverse(e)}optimize(e){return this.traverse(e,!0)}traverse(e,t=!1){const r=`${e.type}:${e.value||""}`;if(this.uniqueNodes.has(r))return this.uniqueNodes.get(r);let a={...e};return e.children&&(a.children=e.children.map((e=>this.traverse(e,t)))),t&&(a=this.performOptimization(a)),this.uniqueNodes.set(r,a),a}performOptimization(e){if("Program"===e.type)return{...e,children:e.children?.map(this.simplifyNode)||[]};if("VariableDeclaration"===e.type&&e.children){const[t,r]=e.children;if("Literal"===r.type)return{type:"InlineConstant",value:`${t.value}=${r.value}`,children:[]}}return e}simplifyNode(e){return e.type,e}}class i{generate(e){if("Program"===e.type)return e.children?.map((e=>this.generate(e))).join("\n")||"";if("VariableDeclaration"===e.type){const t=e.children?.find((e=>"Identifier"===e.type)),r=e.children?.find((e=>"Literal"===e.type));return`const ${t?.value} = ${r?.value};`}return"InlineConstant"===e.type?`const ${e.value};`:e.value||""}}class n{errors;constructor(){this.errors=[]}validate(e){return this.errors=[],this.traverse(e),this.errors}addError(e,t,r){this.errors.push({code:e,message:t,node:r})}traverse(e){switch(e.type){case"Program":this.validateProgram(e);break;case"VariableDeclaration":this.validateVariableDeclaration(e);break;case"InlineConstant":this.validateInlineConstant(e);break;case"Identifier":this.validateIdentifier(e);break;case"Literal":this.validateLiteral(e);break;case"ArrowFunction":this.validateArrowFunction(e);break;case"TemplateLiteral":this.validateTemplateLiteral(e);break;case"ObjectExpression":this.validateObjectExpression(e);break;case"ArrayExpression":this.validateArrayExpression(e);break;case"SpreadElement":this.validateSpreadElement(e);break;case"DestructuringPattern":this.validateDestructuring(e);break;case"ImportDeclaration":this.validateImport(e);break;case"ExportDeclaration":this.validateExport(e);break;case"ClassDeclaration":this.validateClass(e);break;case"AsyncFunction":this.validateAsyncFunction(e);break;case"AwaitExpression":this.validateAwaitExpression(e);break;default:this.addError("E001",`Unknown node type: ${e.type}`,e)}if(e.children)for(const t of e.children)this.traverse(t)}validateProgram(e){e.children?.length||this.addError("E002","Program must contain at least one statement.",e);const t=e.children?.filter((e=>"ExportDeclaration"===e.type&&"default"===e.value));t&&t.length>1&&this.addError("E003","Multiple default exports are not allowed.",e)}validateVariableDeclaration(e){if(!e.children?.length)return void this.addError("E004","Invalid VariableDeclaration: insufficient children.",e);e.value&&["let","const","var"].includes(e.value)||this.addError("E005","Variable declaration must specify kind (let, const, or var).",e);const t=e.children[0];"DestructuringPattern"===t.type?this.validateDestructuring(t):"Identifier"!==t.type&&this.addError("E006","VariableDeclaration must have a valid identifier or destructuring pattern.",e)}validateArrowFunction(e){if(!e.children?.length)return void this.addError("E007","Arrow function must have a body.",e);const t=e.children[0];"DestructuringPattern"===t.type&&this.validateDestructuring(t);const r=e.children[e.children.length-1];(!r||"BlockStatement"!==r.type&&"Expression"!==r.type)&&this.addError("E008","Arrow function must have a valid body.",e)}validateTemplateLiteral(e){e.children?.forEach((e=>{"TemplateLiteralExpression"===e.type&&(e.value||e.children?.length||this.addError("E009","Template literal expression must not be empty.",e))}))}validateObjectExpression(e){const t=new Set;e.children?.forEach((e=>{"Property"===e.type&&e.value&&(t.has(e.value)&&this.addError("E010",`Duplicate key '${e.value}' in object literal.`,e),t.add(e.value)),"Property"===e.type&&this.validateProperty(e)}))}validateProperty(e){"computed"!==e.value||e.children?.length||this.addError("E011","Computed property name must have an expression.",e),"method"!==e.value||e.children?.find((e=>"FunctionExpression"===e.type))||this.addError("E012","Method property must have a function expression.",e)}validateDestructuring(e){e.children?.length?e.children.forEach((e=>{"AssignmentPattern"===e.type&&(e.children?.length||this.addError("E014","Destructuring assignment must have a default value.",e))})):this.addError("E013","Destructuring pattern must not be empty.",e)}validateClass(e){e.value||this.addError("E015","Class declaration must have a name.",e),e.children?.forEach((e=>{"MethodDefinition"===e.type?this.validateMethodDefinition(e):"PropertyDefinition"===e.type&&this.validatePropertyDefinition(e)}))}validateMethodDefinition(e){e.value||this.addError("E016","Class method must have a name.",e),"constructor"===e.value&&e.children?.find((e=>"AsyncFunction"===e.type))&&this.addError("E017","Constructor cannot be async.",e)}validatePropertyDefinition(e){e.value||e.children?.find((e=>"ComputedPropertyName"===e.type))||this.addError("E018","Class property must have a name or be computed.",e)}validateAsyncFunction(e){e.children?.find((e=>"BlockStatement"===e.type))||this.addError("E019","Async function must have a body.",e)}validateAwaitExpression(e){e.children?.length||this.addError("E020","Await expression must have an argument.",e)}validateImport(e){e.children?.length||this.addError("E021","Import declaration must specify imported values or module.",e)}validateExport(e){e.children?.length||e.value||this.addError("E022","Export declaration must have exported values.",e)}validateSpreadElement(e){e.children?.length||this.addError("E023","Spread element must have an argument.",e)}validateArrayExpression(e){e.children?.forEach((e=>{"SpreadElement"===e.type&&this.validateSpreadElement(e)}))}validateInlineConstant(e){e.value||this.addError("E024","InlineConstant must have a value.",e)}validateIdentifier(e){e.value&&/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e.value)||this.addError("E025",`Invalid identifier name: ${e.value}`,e)}validateLiteral(e){e.value||this.addError("E026","Literal must have a value.",e)}}class s{parse(e){switch(e.type){case"Program":return this.parseProgram(e);case"Statement":return this.parseStatement(e);case"Expression":return this.parseExpression(e);case"VariableDeclaration":return this.parseVariableDeclaration(e);case"InlineConstant":return this.parseInlineConstant(e);case"BinaryExpression":return this.parseBinaryExpression(e);case"BlockStatement":return this.parseBlockStatement(e);case"IfStatement":return this.parseIfStatement(e);case"FunctionDeclaration":return this.parseFunctionDeclaration(e);case"ReturnStatement":return this.parseReturnStatement(e);default:return e.value||""}}parseProgram(e){return e.children?.map((e=>this.parse(e))).filter((e=>null!==e))||[]}parseStatement(e){if(e.value)return e.value;const t=e.children?.map((e=>this.parse(e))).filter((e=>null!==e));return t?.length?`Statement: ${t.join("; ")}`:"Statement: "}parseExpression(e){if(e.value)return e.value;const t=e.children?.map((e=>this.parse(e))).filter((e=>null!==e));return t?.length?`Expression: ${t.join(" ")}`:"Expression: "}parseVariableDeclaration(e){const t=e.children?.map((e=>this.parse(e))).filter((e=>null!==e));return`Declare ${t?.join(" ")||""}`.trimEnd()}parseInlineConstant(e){return`Inline ${e.value||""}`.trimEnd()}parseBinaryExpression(e){const t=e.children?.[0],r=e.children?.[1],a=e.value;return`(${t?this.parse(t):""} ${a} ${r?this.parse(r):""})`.trimEnd()}parseBlockStatement(e){const t=e.children?.map((e=>this.parse(e))).filter((e=>null!==e));return`{${t?.length?" "+t.join("; ")+" ":" "}}`}parseIfStatement(e){const[t,r,a]=e.children||[];return`if (${t?this.parse(t):""}) ${r?this.parse(r):""}${a?` else ${this.parse(a)}`:""}`}parseFunctionDeclaration(e){const t=e.value,r=e.children?.[0];return`function ${t||""} ${r?this.parse(r):""}`.trimEnd()}parseReturnStatement(e){const t=e.children?.[0];return`return ${t?this.parse(t):""}`.trimEnd()}}export{r as JSASTBuilder,i as JSAstGenerator,a as JSAstMinimizer,s as JSParser,t as JSTokenizer,n as JSValidator};
//# sourceMappingURL=index.js.map
